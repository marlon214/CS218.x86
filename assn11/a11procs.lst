     1                                 %line 1+1 a11procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 [section .data]
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 LF equ 10
    22                                 NULL equ 0
    23                                 SPACE equ 0x20
    24                                 
    25                                 TRUE equ 1
    26                                 FALSE equ 0
    27                                 
    28                                 SUCCESS equ 0
    29                                 NOSUCCESS equ 1
    30                                 
    31                                 STDIN equ 0
    32                                 STDOUT equ 1
    33                                 STDERR equ 2
    34                                 
    35                                 SYS_read equ 0
    36                                 SYS_write equ 1
    37                                 SYS_open equ 2
    38                                 SYS_close equ 3
    39                                 SYS_fork equ 57
    40                                 SYS_exit equ 60
    41                                 SYS_creat equ 85
    42                                 SYS_time equ 201
    43                                 
    44                                 O_CREAT equ 0x40
    45                                 O_TRUNC equ 0x200
    46                                 O_APPEND equ 0x400
    47                                 
    48                                 O_RDONLY equ 000000
    49                                 O_WRONLY equ 000001
    50                                 O_RDWR equ 000002
    51                                 
    52                                 S_IRUSR equ 00400
    53                                 S_IWUSR equ 00200
    54                                 S_IXUSR equ 00100
    55                                 
    56                                 
    57                                 
    58                                 
    59                                 MIN_FILE_LEN equ 5
    60                                 
    61                                 
    62                                 BUFF_SIZE equ 750000
    63                                 
    64                                 
    65                                 
    66                                 
    67 00000000 00                     eof db FALSE
    68                                 
    69 00000001 55736167653A202E2F-    usageMsg db "Usage: ./makeThumb <inputFile.bmp> "
    70 00000001 6D616B655468756D62-
    71 00000001 203C696E7075744669-
    72 00000001 6C652E626D703E20   
    73 00000024 3C6F75747075744669-     db "<outputFile.bmp>", LF, NULL
    74 00000024 6C652E626D703E0A00 
    75 00000036 4572726F722C20696E-    errIncomplete db "Error, incomplete command line arguments.", LF, NULL
    76 00000036 636F6D706C65746520-
    77 00000036 636F6D6D616E64206C-
    78 00000036 696E6520617267756D-
    79 00000036 656E74732E0A00     
    80 00000061 4572726F722C20746F-    errExtra db "Error, too many command line arguments.", LF, NULL
    81 00000061 6F206D616E7920636F-
    82 00000061 6D6D616E64206C696E-
    83 00000061 6520617267756D656E-
    84 00000061 74732E0A00         
    85 0000008A 4572726F722C20696E-    errReadName db "Error, invalid source file name.  Must be '.bmp' file.", LF, NULL
    86 0000008A 76616C696420736F75-
    87 0000008A 7263652066696C6520-
    88 0000008A 6E616D652E20204D75-
    89 0000008A 737420626520272E62-
    90 0000008A 6D70272066696C652E-
    91 0000008A 0A00               
    92 000000C2 4572726F722C20696E-    errWriteName db "Error, invalid output file name.  Must be '.bmp' file.", LF, NULL
    93 000000C2 76616C6964206F7574-
    94 000000C2 7075742066696C6520-
    95 000000C2 6E616D652E20204D75-
    96 000000C2 737420626520272E62-
    97 000000C2 6D70272066696C652E-
    98 000000C2 0A00               
    99 000000FA 4572726F722C20756E-    errReadFile db "Error, unable to open input file.", LF, NULL
   100 000000FA 61626C6520746F206F-
   101 000000FA 70656E20696E707574-
   102 000000FA 2066696C652E0A00   
   103 0000011D 4572726F722C20756E-    errWriteFile db "Error, unable to open output file.", LF, NULL
   104 0000011D 61626C6520746F206F-
   105 0000011D 70656E206F75747075-
   106 0000011D 742066696C652E0A00 
   107                                 
   108                                 
   109                                 
   110                                 
   111                                 HEADER_SIZE equ 138
   112                                 
   113 00000141 4572726F722C20756E-    errReadHdr db "Error, unable to read header from source image file."
   114 00000141 61626C6520746F2072-
   115 00000141 656164206865616465-
   116 00000141 722066726F6D20736F-
   117 00000141 7572636520696D6167-
   118 00000141 652066696C652E     
   119 00000175 0A00                    db LF, NULL
   120 00000177 4572726F722C20696E-    errFileType db "Error, invalid file signature.", LF, NULL
   121 00000177 76616C69642066696C-
   122 00000177 65207369676E617475-
   123 00000177 72652E0A00         
   124 00000197 4572726F722C20756E-    errDepth db "Error, unsupported color depth.  Must be 24-bit color."
   125 00000197 737570706F72746564-
   126 00000197 20636F6C6F72206465-
   127 00000197 7074682E20204D7573-
   128 00000197 742062652032342D62-
   129 00000197 697420636F6C6F722E 
   130 000001CD 0A00                    db LF, NULL
   131 000001CF 4572726F722C206F6E-    errCompType db "Error, only non-compressed images are supported."
   132 000001CF 6C79206E6F6E2D636F-
   133 000001CF 6D7072657373656420-
   134 000001CF 696D61676573206172-
   135 000001CF 6520737570706F7274-
   136 000001CF 65642E             
   137 000001FF 0A00                    db LF, NULL
   138 00000201 4572726F722C206269-    errSize db "Error, bitmap block size inconsistent.", LF, NULL
   139 00000201 746D617020626C6F63-
   140 00000201 6B2073697A6520696E-
   141 00000201 636F6E73697374656E-
   142 00000201 742E0A00           
   143 00000229 4572726F722C20756E-    errWriteHdr db "Error, unable to write header to output image file.", LF,
   144 00000229 61626C6520746F2077-
   145 00000229 726974652068656164-
   146 00000229 657220746F206F7574-
   147 00000229 70757420696D616765-
   148 00000229 2066696C652E0A     
   149 0000025D 50726F6772616D2074-     db "Program terminated.", LF, NULL
   150 0000025D 65726D696E61746564-
   151 0000025D 2E0A00             
   152                                 
   153                                 
   154                                 
   155                                 
   156 00000272 B0710B0000000000       buffMax dq BUFF_SIZE
   157 0000027A B0710B0000000000       curr dq BUFF_SIZE
   158 00000282 00                     wasEOF db FALSE
   159 00000283 0000000000000000       pixelCount dq 0
   160                                 
   161 0000028B 4572726F722C207265-    errRead db "Error, reading from source image file.", LF,
   162 0000028B 6164696E672066726F-
   163 0000028B 6D20736F7572636520-
   164 0000028B 696D6167652066696C-
   165 0000028B 652E0A             
   166 000002B2 50726F6772616D2074-     db "Program terminated.", LF, NULL
   167 000002B2 65726D696E61746564-
   168 000002B2 2E0A00             
   169                                 
   170                                 
   171                                 
   172 000002C7 4572726F722C207772-    errWrite db "Error, writting to output image file.", LF,
   173 000002C7 697474696E6720746F-
   174 000002C7 206F75747075742069-
   175 000002C7 6D6167652066696C65-
   176 000002C7 2E0A               
   177 000002ED 50726F6772616D2074-     db "Program terminated.", LF, NULL
   178 000002ED 65726D696E61746564-
   179 000002ED 2E0A00             
   180                                 
   181                                 
   182                                 
   183                                 
   184                                 [section .bss]
   185                                 
   186 00000000 <gap>                  buffer resb BUFF_SIZE
   187 000B71B0 <gap>                  header resb HEADER_SIZE
   188                                 
   189                                 
   190                                 
   191                                 [section .text]
   192                                 
   193                                 
   194                                 
   195                                 
   196                                 
   197                                 
   198                                 
   199                                 
   200                                 
   201                                 
   202                                 
   203                                 
   204                                 
   205                                 
   206                                 
   207                                 
   208                                 
   209                                 
   210                                 
   211                                 [global getImageFileNames]
   212                                 getImageFileNames:
   213 00000000 55                      push rbp
   214 00000001 53                      push rbx
   215 00000002 57                      push rdi
   216 00000003 56                      push rsi
   217 00000004 4152                    push r10
   218 00000006 4153                    push r11
   219 00000008 4154                    push r12
   220 0000000A 4155                    push r13
   221 0000000C 4156                    push r14
   222 0000000E 4157                    push r15
   223 00000010 52                      push rdx
   224                                 
   225 00000011 4989CA                  mov r10, rcx
   226 00000014 49C7C700000000          mov r15, 0
   227 0000001B 49C7C600000000          mov r14, 0
   228                                 
   229 00000022 4883FF01                cmp rdi, 1
   230 00000026 0F84F8000000            je promptUser
   231 0000002C 4883FF02                cmp rdi, 2
   232 00000030 0F8427010000            je fewArg
   233 00000036 4883FF03                cmp rdi, 3
   234 0000003A 0F8730010000            ja tooMuchArg
   235                                 
   236                                 
   237 00000040 488B5E08                mov rbx, qword[rsi+8]
   238 00000044 4C8B6E08                mov r13, qword[rsi+8]
   239 00000048 4C8B6610                mov r12, qword[rsi+16]
   240                                 
   241                                  validateReadFileType:
   242 0000004C 428A0433                mov al, byte[rbx+r14]
   243 00000050 49FFC6                  inc r14
   244 00000053 3C00                    cmp al, NULL
   245 00000055 0F8428010000            je badReadName
   246 0000005B 3C2E                    cmp al, "."
   247 0000005D 75EB                    jne validateReadFileType
   248 0000005F 428A0433                mov al, byte[rbx+r14]
   249 00000063 6642813C33626D          cmp word[rbx+r14], "bm"
   250 0000006A 0F8513010000            jne badReadName
   251 00000070 49FFC6                  inc r14
   252 00000073 49FFC6                  inc r14
   253 00000076 428A0433                mov al, byte[rbx+r14]
   254 0000007A 42803C3370              cmp byte[rbx+r14], "p"
   255 0000007F 0F85FE000000            jne badReadName
   256 00000085 49FFC6                  inc r14
   257 00000088 428A0433                mov al, byte[rbx+r14]
   258 0000008C 42803C3300              cmp byte[rbx+r14], NULL
   259 00000091 0F85EC000000            jne badReadName
   260                                 
   261 00000097 488B5E10                mov rbx, qword[rsi+16]
   262 0000009B 49C7C600000000          mov r14, 0
   263                                 
   264                                  validateWriteFileType:
   265 000000A2 428A0433                mov al, byte[rbx+r14]
   266 000000A6 49FFC6                  inc r14
   267 000000A9 3C00                    cmp al, NULL
   268 000000AB 0F84E5000000            je badWriteName
   269 000000B1 3C2E                    cmp al, "."
   270 000000B3 75EB                    jne validateWriteFileType
   271 000000B5 428A0433                mov al, byte[rbx+r14]
   272 000000B9 6642813C33626D          cmp word[rbx+r14], "bm"
   273 000000C0 0F85D0000000            jne badWriteName
   274 000000C6 49FFC6                  inc r14
   275 000000C9 49FFC6                  inc r14
   276 000000CC 428A0433                mov al, byte[rbx+r14]
   277 000000D0 42803C3370              cmp byte[rbx+r14], "p"
   278 000000D5 0F85BB000000            jne badWriteName
   279 000000DB 49FFC6                  inc r14
   280 000000DE 428A0433                mov al, byte[rbx+r14]
   281 000000E2 42803C3300              cmp byte[rbx+r14], NULL
   282 000000E7 0F85A9000000            jne badWriteName
   283                                 
   284                                 
   285                                 
   286                                 
   287                                 
   288                                 
   289                                 
   290                                 
   291                                 
   292                                 
   293                                 
   294 000000ED 48C7C002000000          mov rax, SYS_open
   295 000000F4 4C89EF                  mov rdi, r13
   296 000000F7 48C7C600000000          mov rsi, O_RDONLY
   297 000000FE 0F05                    syscall
   298 00000100 4883F800                cmp rax, 0
   299 00000104 7C48                    jl errorReadOpen
   300 00000106 488902                  mov qword[rdx], rax
   301                                 
   302                                 
   303 00000109 48C7C055000000          mov rax, SYS_creat
   304 00000110 4C89E7                  mov rdi, r12
   305 00000113 48C7C680010000          mov rsi, S_IRUSR | S_IWUSR
   306 0000011A 0F05                    syscall
   307 0000011C 4883F800                cmp rax, 0
   308 00000120 7C19                    jl errorWriteOpen
   309 00000122 498902                  mov qword[r10], rax
   310                                 
   311 00000125 E99C000000              jmp true
   312                                 
   313                                  promptUser:
   314 0000012A 48C7C6[00000000]        mov rsi, usageMsg
   315 00000131 49FFC7                  inc r15
   316 00000134 42803C3E00              cmp byte[rsi+r15], NULL
   317 00000139 75ED                    jne promptUser
   318 0000013B EB70                    jmp false
   319                                 
   320                                  errorWriteOpen:
   321 0000013D 48C7C6[00000000]        mov rsi, errWriteFile
   322 00000144 49FFC7                  inc r15
   323 00000147 42803C3E00              cmp byte[rsi+r15], NULL
   324 0000014C 75ED                    jne errorWriteOpen
   325 0000014E EB5D                    jmp false
   326                                 
   327                                  errorReadOpen:
   328 00000150 48C7C6[00000000]        mov rsi, errReadFile
   329 00000157 49FFC7                  inc r15
   330 0000015A 42803C3E00              cmp byte[rsi+r15], NULL
   331 0000015F 75ED                    jne errorReadOpen
   332 00000161 EB4A                    jmp false
   333                                 
   334                                  fewArg:
   335 00000163 48C7C6[00000000]        mov rsi, errIncomplete
   336 0000016A 49FFC7                  inc r15
   337 0000016D 42803C3E00              cmp byte[rsi+r15], NULL
   338 00000172 75ED                    jne fewArg
   339 00000174 EB37                    jmp false
   340                                 
   341                                  tooMuchArg:
   342 00000176 48C7C6[00000000]        mov rsi, errExtra
   343 0000017D 49FFC7                  inc r15
   344 00000180 42803C3E00              cmp byte[rsi+r15], NULL
   345 00000185 75ED                    jne tooMuchArg
   346 00000187 EB24                    jmp false
   347                                 
   348                                  badReadName:
   349 00000189 48C7C6[00000000]        mov rsi, errReadName
   350 00000190 49FFC7                  inc r15
   351 00000193 42803C3E00              cmp byte[rsi+r15], NULL
   352 00000198 75ED                    jne badReadName
   353                                 
   354 0000019A EB11                    jmp false
   355                                 
   356                                  badWriteName:
   357 0000019C 48C7C6[00000000]        mov rsi, errWriteName
   358 000001A3 49FFC7                  inc r15
   359 000001A6 42803C3E00              cmp byte[rsi+r15], NULL
   360 000001AB 75ED                    jne badWriteName
   361 000001AD EBFE                    jmp false
   362                                 
   363                                  false:
   364 000001AF 48C7C001000000          mov rax, SYS_write
   365 000001B6 48C7C701000000          mov rdi, STDOUT
   366 000001BD 4C89FA                  mov rdx, r15
   367 000001C0 0F05                    syscall
   368 000001C2 48C7C000000000          mov rax, FALSE
   369 000001C9 EB05                    jmp done
   370                                 
   371                                  true:
   372 000001CB 48C7C001000000          mov rax, TRUE
   373                                 
   374                                  done:
   375 000001D2 5A                      pop rdx
   376 000001D3 415F                    pop r15
   377 000001D5 415E                    pop r14
   378 000001D7 415D                    pop r13
   379 000001D9 415C                    pop r12
   380 000001DB 415B                    pop r11
   381 000001DD 415A                    pop r10
   382 000001DF 5E                      pop rsi
   383 000001E0 5F                      pop rdi
   384 000001E1 5B                      pop rbx
   385 000001E2 5D                      pop rbp
   386 000001E3 C3                      ret
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 
   403                                 
   404                                 
   405                                 
   406                                 
   407                                 
   408                                 
   409                                 
   410                                 
   411                                 
   412                                 
   413                                 
   414                                 
   415                                 
   416                                 
   417                                 
   418                                 
   419                                 
   420                                 
   421                                 
   422                                 
   423                                 
   424                                 
   425                                 [global setImageInfo]
   426                                 setImageInfo:
   427 000001E4 55                      push rbp
   428 000001E5 4889E5                  mov rbp,rsp
   429 000001E8 57                      push rdi
   430 000001E9 56                      push rsi
   431 000001EA 53                      push rbx
   432 000001EB 4152                    push r10
   433 000001ED 4154                    push r12
   434 000001EF 4155                    push r13
   435 000001F1 4156                    push r14
   436 000001F3 4157                    push r15
   437                                 
   438 000001F5 49C7C700000000          mov r15, 0
   439 000001FC 49C7C600000000          mov r14, 0
   440 00000203 4989F2                  mov r10, rsi
   441 00000206 4989CD                  mov r13, rcx
   442 00000209 4989D4                  mov r12, rdx
   443                                 
   444 0000020C 48C7C000000000          mov rax, SYS_read
   445                                 
   446 00000213 48C7C6[00000000]        mov rsi, header
   447 0000021A 48C7C28A000000          mov rdx, HEADER_SIZE
   448 00000221 0F05                    syscall
   449                                 
   450 00000223 4883F800                cmp rax, 0
   451 00000227 0F8CD8000000            jl readHeader
   452                                 
   453                                 
   454                                 
   455                                 
   456                                 
   457                                 
   458 0000022D 66813E424D              cmp word[rsi], "BM"
   459 00000232 0F85BA000000            jne sig
   460                                 
   461                                 
   462                                 
   463                                 
   464                                 
   465                                 
   466                                 
   467                                 
   468                                 
   469 00000238 66837E1C18              cmp word[rsi+28], 24
   470 0000023D 0F859C000000            jne color
   471                                 
   472                                 
   473                                 
   474                                 
   475                                 
   476                                 
   477                                 
   478                                 
   479                                 
   480                                 
   481 00000243 837E1E00                cmp dword[rsi+30], 0
   482 00000247 0F857F000000            jne compress
   483                                 
   484                                 
   485                                 
   486                                 
   487                                 
   488                                 
   489                                 
   490                                 
   491                                 
   492                                 
   493                                 
   494                                 
   495                                 
   496                                 
   497                                 
   498                                 
   499                                 
   500                                 
   501                                 
   502 0000024D 448B7616                mov r14d, dword[rsi+22]
   503 00000251 45897500                mov dword[r13], r14d
   504 00000255 448B7612                mov r14d, dword[rsi+18]
   505 00000259 45893424                mov dword[r12], r14d
   506                                 
   507                                 
   508 0000025D 48C7C000000000          mov rax, 0
   509 00000264 8B4622                  mov eax, dword[rsi+34]
   510 00000267 03460A                  add eax, dword[rsi+10]
   511 0000026A 3B4602                  cmp eax, dword[rsi+2]
   512 0000026D 754E                    jne blockSize
   513                                 
   514                                 
   515                                 
   516 0000026F 48C7C003000000          mov rax, 3
   517 00000276 49F7E0                  mul r8
   518 00000279 49F7E1                  mul r9
   519                                 
   520 0000027C 030425[0A000000]        add eax, dword[header+10]
   521 00000283 890425[02000000]        mov dword[header+2], eax
   522 0000028A 44890425[12000000]      mov dword[header+18], r8d
   523 00000292 44890C25[16000000]      mov dword[header+22], r9d
   524                                 
   525                                 
   526 0000029A 48C7C001000000          mov rax, SYS_write
   527 000002A1 4C89D7                  mov rdi, r10
   528 000002A4 48C7C6[00000000]        mov rsi, header
   529 000002AB 48C7C28A000000          mov rdx, HEADER_SIZE
   530 000002B2 0F05                    syscall
   531 000002B4 4883F800                cmp rax, 0
   532 000002B8 7C62                    jl writeHeader
   533                                 
   534 000002BA E989000000              jmp false2
   535                                 
   536                                  blockSize:
   537 000002BF 48C7C6[00000000]        mov rsi, errSize
   538 000002C6 49FFC7                  inc r15
   539 000002C9 42803C3E00              cmp byte[rsi+r15], NULL
   540 000002CE 75ED                    jne blockSize
   541 000002D0 EB5D                    jmp true2
   542                                 
   543                                  compress:
   544 000002D2 48C7C6[00000000]        mov rsi, errCompType
   545 000002D9 49FFC7                  inc r15
   546 000002DC 42803C3E00              cmp byte[rsi+r15], NULL
   547 000002E1 75ED                    jne compress
   548 000002E3 EB4A                    jmp true2
   549                                 
   550                                  color:
   551 000002E5 48C7C6[00000000]        mov rsi, errDepth
   552 000002EC 49FFC7                  inc r15
   553 000002EF 42803C3E00              cmp byte[rsi+r15], NULL
   554 000002F4 75ED                    jne color
   555 000002F6 EB37                    jmp true2
   556                                 
   557                                  sig:
   558 000002F8 48C7C6[00000000]        mov rsi, errFileType
   559 000002FF 49FFC7                  inc r15
   560 00000302 42803C3E00              cmp byte[rsi+r15], NULL
   561 00000307 75ED                    jne sig
   562 00000309 EB24                    jmp true2
   563                                 
   564                                  readHeader:
   565 0000030B 48C7C6[00000000]        mov rsi, errReadHdr
   566 00000312 49FFC7                  inc r15
   567 00000315 42803C3E00              cmp byte[rsi+r15], NULL
   568 0000031A 75ED                    jne readHeader
   569 0000031C EB11                    jmp true2
   570                                 
   571                                  writeHeader:
   572 0000031E 48C7C6[00000000]        mov rsi, errWriteHdr
   573 00000325 49FFC7                  inc r15
   574 00000328 42803C3E00              cmp byte[rsi+r15], NULL
   575 0000032D 75ED                    jne writeHeader
   576 0000032F EBFE                    jmp true2
   577                                 
   578                                  true2:
   579 00000331 48C7C001000000          mov rax, SYS_write
   580 00000338 48C7C701000000          mov rdi, STDOUT
   581 0000033F 4C89FA                  mov rdx, r15
   582 00000342 0F05                    syscall
   583 00000344 48C7C000000000          mov rax, FALSE
   584 0000034B EB05                    jmp done2
   585                                 
   586                                  false2:
   587 0000034D 48C7C001000000          mov rax, TRUE
   588                                 
   589                                 
   590                                 
   591                                 
   592                                 
   593                                 
   594                                 
   595                                 
   596                                 
   597                                 
   598                                 
   599                                 
   600                                 
   601                                 
   602                                  done2:
   603 00000354 415F                    pop r15
   604 00000356 415E                    pop r14
   605 00000358 415D                    pop r13
   606 0000035A 415C                    pop r12
   607 0000035C 415A                    pop r10
   608 0000035E 5B                      pop rbx
   609 0000035F 5E                      pop rsi
   610 00000360 5F                      pop rdi
   611 00000361 5D                      pop rbp
   612 00000362 C3                      ret
   613                                 
   614                                 
   615                                 
   616                                 
   617                                 
   618                                 
   619                                 
   620                                 
   621                                 
   622                                 
   623                                 
   624                                 
   625                                 
   626                                 
   627                                 
   628                                 
   629                                 
   630                                 
   631                                 
   632                                 
   633                                 
   634                                 
   635                                 
   636                                 
   637                                 
   638                                 [global readRow]
   639                                 readRow:
   640                                 
   641                                 
   642                                 
   643                                 
   644                                 
   645                                 
   646                                 
   647                                 
   648                                 
   649                                 
   650 00000363 55                      push rbp
   651 00000364 4889E5                  mov rbp,rsp
   652 00000367 57                      push rdi
   653 00000368 56                      push rsi
   654 00000369 53                      push rbx
   655 0000036A 4152                    push r10
   656 0000036C 4154                    push r12
   657 0000036E 4155                    push r13
   658 00000370 4156                    push r14
   659 00000372 4157                    push r15
   660                                 
   661 00000374 49C7C700000000          mov r15, 0
   662 0000037B 49C7C6B0710B00          mov r14, BUFF_SIZE
   663 00000382 4989D5                  mov r13, rdx
   664 00000385 48C7C003000000          mov rax, 3
   665 0000038C 48F7E6                  mul rsi
   666 0000038F 4989C4                  mov r12, rax
   667 00000392 48C7C300000000          mov rbx, 0
   668 00000399 49C7C200000000          mov r10, 0
   669                                 
   670                                  next:
   671 000003A0 4C393425[00000000]      cmp qword[curr], r14
   672 000003A8 7C4D                    jl loadBuffer
   673 000003AA 48833C25[00000000]-     cmp qword[wasEOF], FALSE
   674 000003AA 00                 
   675 000003B3 0F8587000000            jne false3
   676                                 
   677 000003B9 48C7C000000000          mov rax, SYS_read
   678 000003C0 48C7C6[00000000]        mov rsi, buffer
   679 000003C7 48C7C2B0710B00          mov rdx, BUFF_SIZE
   680 000003CE 0F05                    syscall
   681 000003D0 4883F800                cmp rax, 0
   682 000003D4 7C4A                    jl errorReadRow
   683                                 
   684 000003D6 483DB0710B00            cmp rax, BUFF_SIZE
   685 000003DC 740D                    je contRead
   686                                 
   687 000003DE 48C70425[00000000]-     mov qword[wasEOF], TRUE
   688 000003DE 01000000           
   689 000003EA 4989C6                  mov r14, rax
   690                                 
   691                                  contRead:
   692 000003ED 48C70425[00000000]-     mov qword[curr], 0
   693 000003ED 00000000           
   694                                 
   695                                  loadBuffer:
   696 000003F9 4C8B3C25[00000000]      mov r15, qword[curr]
   697 00000401 418A9F[00000000]        mov bl, byte[buffer + r15]
   698 00000408 49FFC7                  inc r15
   699 0000040B 4C893C25[00000000]      mov qword[curr], r15
   700 00000413 43885C1500              mov byte[r13+r10], bl
   701 00000418 49FFC2                  inc r10
   702                                 
   703 0000041B 4D39E2                  cmp r10, r12
   704 0000041E 7C7E                    jl next
   705                                 
   706 00000420 EB2B                    jmp true3
   707                                 
   708                                  errorReadRow:
   709 00000422 48C7C6[00000000]        mov rsi, errRead
   710 00000429 49FFC7                  inc r15
   711 0000042C 42803C3E00              cmp byte[rsi+r15], NULL
   712 00000431 75ED                    jne errorReadRow
   713 00000433 48C7C001000000          mov rax, SYS_write
   714 0000043A 48C7C701000000          mov rdi, STDOUT
   715 00000441 4C89FA                  mov rdx, r15
   716 00000444 0F05                    syscall
   717                                 
   718                                  false3:
   719 00000446 48C7C000000000          mov rax, FALSE
   720 0000044D EB05                    jmp done3
   721                                 
   722                                  true3:
   723 0000044F 48C7C001000000          mov rax, TRUE
   724                                 
   725                                  done3:
   726                                 
   727 00000456 415F                    pop r15
   728 00000458 415E                    pop r14
   729 0000045A 415D                    pop r13
   730 0000045C 415C                    pop r12
   731 0000045E 415A                    pop r10
   732 00000460 5B                      pop rbx
   733 00000461 5E                      pop rsi
   734 00000462 5F                      pop rdi
   735 00000463 4889EC                  mov rsp, rbp
   736 00000466 5D                      pop rbp
   737 00000467 C3                      ret
   738                                 
   739                                 
   740                                 
   741                                 
   742                                 
   743                                 
   744                                 
   745                                 
   746                                 
   747                                 
   748                                 
   749                                 
   750                                 
   751                                 
   752                                 
   753                                 
   754                                 
   755                                 
   756                                 
   757                                 
   758                                 
   759                                 
   760                                 
   761                                 
   762                                 
   763                                 
   764                                 [global writeRow]
   765                                 writeRow:
   766                                 
   767 00000468 55                      push rbp
   768 00000469 4889E5                  mov rbp, rsp
   769 0000046C 4157                    push r15
   770 0000046E 49C7C700000000          mov r15 ,0
   771                                 
   772 00000475 52                      push rdx
   773 00000476 48C7C003000000          mov rax, 3
   774 0000047D 48F7E6                  mul rsi
   775 00000480 4889C3                  mov rbx, rax
   776 00000483 5A                      pop rdx
   777                                 
   778 00000484 48C7C001000000          mov rax, SYS_write
   779 0000048B 4889D6                  mov rsi, rdx
   780 0000048E 4889DA                  mov rdx, rbx
   781 00000491 0F05                    syscall
   782                                 
   783 00000493 4883F800                cmp rax, 0
   784 00000497 7C07                    jl writeRowError
   785                                 
   786 00000499 48C7C001000000          mov rax, TRUE
   787 000004A0 EB29                    jmp done4
   788                                 
   789                                  writeRowError:
   790 000004A2 48C7C6[00000000]        mov rsi, errWrite
   791 000004A9 49FFC7                  inc r15
   792 000004AC 42803C3E00              cmp byte[rsi+r15], NULL
   793 000004B1 75ED                    jne writeRowError
   794 000004B3 48C7C001000000          mov rax, SYS_write
   795 000004BA 48C7C701000000          mov rdi, STDOUT
   796 000004C1 4C89FA                  mov rdx, r15
   797 000004C4 0F05                    syscall
   798 000004C6 48C7C000000000          mov rax, FALSE
   799                                 
   800                                  done4:
   801                                 
   802 000004CD 415F                    pop r15
   803 000004CF 4889EC                  mov rsp, rbp
   804 000004D2 5D                      pop rbp
   805 000004D3 C3                      ret
   806                                 
   807                                 
   808                                 
   809                                 
   810                                 
   811                                 
   812                                 
   813                                 
   814                                 
   815                                 
   816                                 
   817                                 
   818                                 [global printString]
   819                                 printString:
   820 000004D4 53                      push rbx
   821                                 
   822                                 
   823                                 
   824                                 
   825 000004D5 4889FB                  mov rbx, rdi
   826 000004D8 48C7C200000000          mov rdx, 0
   827                                 strCountLoop:
   828 000004DF 803B00                  cmp byte [rbx], NULL
   829 000004E2 7406                    je strCountDone
   830 000004E4 48FFC3                  inc rbx
   831 000004E7 48FFC2                  inc rdx
   832 000004EA EBF1                    jmp strCountLoop
   833                                 strCountDone:
   834                                 
   835 000004EC 4883FA00                cmp rdx, 0
   836 000004F0 7411                    je prtDone
   837                                 
   838                                 
   839                                 
   840                                 
   841 000004F2 48C7C001000000          mov rax, SYS_write
   842 000004F9 4889FE                  mov rsi, rdi
   843 000004FC 48C7C701000000          mov rdi, STDOUT
   844                                 
   845 00000503 0F05                    syscall
   846                                 
   847                                 
   848                                 
   849                                 
   850                                 prtDone:
   851 00000505 5B                      pop rbx
   852 00000506 C3                      ret
   853                                 
   854                                 
